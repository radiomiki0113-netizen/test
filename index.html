<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>エクセルみたいな表（二段表示＋ブラウザ保存＋CSV入出力＋列追加）</title>
  <style>
    body {
      font-family: sans-serif;
    }

    /* 表全体のスタイル */
    .table-container {
      display: block;
      margin-bottom: 20px;
    }

    table { 
      border-collapse: collapse; 
      margin: 10px 0; 
      width: 100%;
    }
    th, td { 
      border: 1px solid #ccc; 
      padding: 5px; 
      min-width: 80px; 
    }
    th { background: #eee; }
    td { background: #fcfcf5; }

    /* ボタン用 */
    button, label[for="csvFileInput"] {
      margin: 5px;
      padding: 5px 10px;
      border: 1px solid #888;
      border-radius: 4px;
      background: #f0f0f0;
      cursor: pointer;
      color: black;
      text-decoration: none;
    }

    input[type="file"] {
      display: none; /* 本来のファイル選択を隠す */
    }
  </style>
</head>
<body>
  <h2>エクセルみたいな表（二段表示）</h2>

  <div class="table-container">
    <table id="sheet1">
      <thead>
        <tr id="header1">
          <th>A</th>
          <th>B</th>
          <th>C</th>
          <th>D</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="table-container">
    <table id="sheet2">
      <thead>
        <tr id="header2">
          <th>A</th>
          <th>B</th>
          <th>C</th>
          <th>D</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
          <td contenteditable="true"></td>
        </tr>
      </tbody>
    </table>
  </div>

  <button onclick="addRow()">行を追加</button>
  <button onclick="addColumn()">列を追加</button>
  <button onclick="saveTable()">保存</button>
  <button onclick="downloadCSV()">CSVとして保存</button>

  <label for="csvFileInput">CSVを読み込む</label>
  <input type="file" id="csvFileInput" accept=".csv" onchange="uploadCSV(event)">
  
  <button onclick="resetTable()">リセット</button>

  <script>
    const table1 = document.getElementById("sheet1").getElementsByTagName("tbody")[0];
    const table2 = document.getElementById("sheet2").getElementsByTagName("tbody")[0];
    const header1 = document.getElementById("header1");
    const header2 = document.getElementById("header2");

    // 行追加
    function addRow() {
      let row1 = table1.insertRow();
      let row2 = table2.insertRow();
      for (let i = 0; i < header1.cells.length; i++) {
        let cell1 = row1.insertCell();
        let cell2 = row2.insertCell();
        cell1.contentEditable = "true";
        cell2.contentEditable = "true";
      }
    }

    // 列追加
    function addColumn() {
      let colIndex = header1.cells.length;
      let colName = String.fromCharCode(65 + colIndex); // A=65
      let th1 = document.createElement("th");
      let th2 = document.createElement("th");
      th1.textContent = colName;
      th2.textContent = colName;
      header1.appendChild(th1);
      header2.appendChild(th2);

      for (let i = 0; i < table1.rows.length; i++) {
        let cell1 = table1.rows[i].insertCell();
        let cell2 = table2.rows[i].insertCell();
        cell1.contentEditable = "true";
        cell2.contentEditable = "true";
      }
    }

    // 保存（localStorage）
    function saveTable() {
      let data1 = [];
      let data2 = [];
      for (let r = 0; r < table1.rows.length; r++) {
        let row1 = [];
        let row2 = [];
        for (let c = 0; c < table1.rows[r].cells.length; c++) {
          row1.push(table1.rows[r].cells[c].innerText);
          row2.push(table2.rows[r].cells[c].innerText);
        }
        data1.push(row1);
        data2.push(row2);
      }
      localStorage.setItem("myTable1", JSON.stringify(data1));
      localStorage.setItem("myTable2", JSON.stringify(data2));
      alert("保存しました！");
    }

    // 読み込み
    window.onload = function() {
      let data1 = JSON.parse(localStorage.getItem("myTable1") || "[]");
      let data2 = JSON.parse(localStorage.getItem("myTable2") || "[]");
      if (data1.length > 0 && data2.length > 0) {
        table1.innerHTML = "";
        table2.innerHTML = "";
        data1.forEach((r, index) => {
          let row1 = table1.insertRow();
          let row2 = table2.insertRow();
          r.forEach((val, i) => {
            let cell1 = row1.insertCell();
            let cell2 = row2.insertCell();
            cell1.contentEditable = "true";
            cell2.contentEditable = "true";
            cell1.innerText = val;
            cell2.innerText = data2[index][i];
          });
        });
      }
    }

    // CSV保存
    function downloadCSV() {
      let csv1 = [];
      let csv2 = [];
      for (let r = 0; r < table1.rows.length; r++) {
        let row1 = [];
        let row2 = [];
        for (let c = 0; c < table1.rows[r].cells.length; c++) {
          row1.push('"' + table1.rows[r].cells[c].innerText.replace(/"/g, '""') + '"');
          row2.push('"' + table2.rows[r].cells[c].innerText.replace(/"/g, '""') + '"');
        }
        csv1.push(row1.join(","));
        csv2.push(row2.join(","));
      }
      let blob1 = new Blob([csv1.join("\n")], { type: "text/csv" });
      let blob2 = new Blob([csv2.join("\n")], { type: "text/csv" });
      let link1 = document.createElement("a");
      let link2 = document.createElement("a");
      link1.href = URL.createObjectURL(blob1);
      link2.href = URL.createObjectURL(blob2);
      link1.download = "table1.csv";
      link2.download = "table2.csv";
      link1.click();
      link2.click();
    }

    // CSV読み込み
    function uploadCSV(event) {
      let file = event.target.files[0];
      if (!file) return;
      let reader = new FileReader();
      reader.onload = function(e) {
        let rows = e.target.result.split("\n").map(r => r.split(","));
        table1.innerHTML = "";
        table2.innerHTML = "";
        rows.forEach(r => {
          let row1 = table1.insertRow();
          let row2 = table2.insertRow();
          r.forEach(val => {
            let cell1 = row1.insertCell();
            let cell2 = row2.insertCell();
            cell1.contentEditable = "true";
            cell2.contentEditable = "true";
            cell1.innerText = val.replace(/^"|"$/g, '').replace(/""/g, '"');
            cell2.innerText = val.replace(/^"|"$/g, '').replace(/""/g, '"');
          });
        });
      };
      reader.readAsText(file);
    }

    // リセット
    function resetTable() {
      table1.innerHTML = "<tr><td contenteditable='true'></td><td contenteditable='true'></td><td contenteditable='true'></td><td contenteditable='true'></td></tr>";
      table2.innerHTML = "<tr><td contenteditable='true'></td><td contenteditable='true'></td><td contenteditable='true'></td><td contenteditable='true'></td></tr>";
      localStorage.removeItem("myTable1");
      localStorage.removeItem("myTable2");
    }
  </script>
</body>
</html>