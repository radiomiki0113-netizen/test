<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>就職活動 メモ</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    h1 { font-size: 2em; margin-bottom: 5px; }
    .subtitle { font-size: 1em; color: #555; margin-top: 0; margin-bottom: 10px; }
    .table-container { display: block; margin-bottom: 30px; }
    table { border-collapse: collapse; margin: 10px 0; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 5px; min-width: 80px; text-align: left; }
    th { background: #eee; }
    td { background: #fcfcf5; }
    button, label[for="csvFileInput"] {
      margin: 5px; padding: 5px 10px;
      border: 1px solid #888; border-radius: 4px;
      background: #f0f0f0; cursor: pointer;
      color: black; text-decoration: none;
    }
    input[type="file"] { display: none; }
  </style>
</head>
<body>

  <!-- ページ最上部タイトル -->
  <h1>就職活動 メモ</h1>
  <br>

  <!-- 1段目の表 -->
  <p class="subtitle">動いている企業</p>
  <div class="table-container">
    <table id="sheet1">
      <thead>
        <tr id="header1"></tr>
      </thead>
      <tbody>
        <tr></tr>
      </tbody>
    </table>
  </div>

  <!-- 2段目の表 -->
  <p class="subtitle">2段目の表用サブタイトル</p>
  <div class="table-container">
    <table id="sheet2">
      <thead>
        <tr id="header2"></tr>
      </thead>
      <tbody>
        <tr></tr>
      </tbody>
    </table>
  </div>

  <!-- ボタン群 -->
  <button onclick="addRow(0)">1段目に行追加</button>
  <button onclick="addColumn(0)">1段目に列追加</button>
  <button onclick="addRow(1)">2段目に行追加</button>
  <button onclick="addColumn(1)">2段目に列追加</button>
  <button onclick="saveTable()">保存</button>
  <button onclick="downloadCSV()">CSVとして保存</button>
  <label for="csvFileInput">CSVを読み込む</label>
  <input type="file" id="csvFileInput" accept=".csv" onchange="uploadCSV(event)">
  <button onclick="resetTable()">リセット</button>

  <script>
    const tables = [
      { tbody: document.querySelector("#sheet1 tbody"), header: document.getElementById("header1"), table: document.getElementById("sheet1") },
      { tbody: document.querySelector("#sheet2 tbody"), header: document.getElementById("header2"), table: document.getElementById("sheet2") }
    ];

    // 行追加
    function addRow(index) {
      let t = tables[index];
      let row = t.tbody.insertRow();
      for (let i = 0; i < t.header.cells.length; i++) {
        let cell = row.insertCell();
        cell.contentEditable = "true";
      }
    }

    // 列追加
    function addColumn(index) {
      let t = tables[index];
      let colName = prompt("列名を入力してください", "新しい列");
      if (!colName) return;
      let th = document.createElement("th");
      th.textContent = colName;
      t.header.appendChild(th);

      for (let i = 0; i < t.tbody.rows.length; i++) {
        let cell = t.tbody.rows[i].insertCell();
        cell.contentEditable = "true";
      }
    }

    // 保存
    function saveTable() {
      tables.forEach((t,i)=>{
        let data = {
          headers: [],
          rows: []
        };
        for(let c=0;c<t.header.cells.length;c++){
          data.headers.push(t.header.cells[c].innerText);
        }
        for(let r=0;r<t.tbody.rows.length;r++){
          let row=[];
          for(let c=0;c<t.tbody.rows[r].cells.length;c++){
            row.push(t.tbody.rows[r].cells[c].innerText);
          }
          data.rows.push(row);
        }
        localStorage.setItem("myTable"+(i+1), JSON.stringify(data));
      });
      alert("保存しました！");
    }

    // 読み込み
    window.onload = function() {
      tables.forEach((t,i)=>{
        let saved = JSON.parse(localStorage.getItem("myTable"+(i+1)) || "null");
        if(saved){
          t.header.innerHTML="";
          saved.headers.forEach(h=>{
            let th=document.createElement("th");
            th.textContent=h;
            t.header.appendChild(th);
          });
          t.tbody.innerHTML="";
          saved.rows.forEach(r=>{
            let row=t.tbody.insertRow();
            r.forEach(val=>{
              let cell=row.insertCell();
              cell.contentEditable="true";
              cell.innerText=val;
            });
          });
        }
      });
    }

    // CSV保存（1段目と2段目をまとめて保存）
    function downloadCSV() {
      let csv = [];
      tables.forEach((t,i)=>{
        let headers = [];
        for(let c=0;c<t.header.cells.length;c++){
          headers.push('"' + t.header.cells[c].innerText.replace(/"/g, '""') + '"');
        }
        csv.push(headers.join(","));
        for(let r=0;r<t.tbody.rows.length;r++){
          let row=[];
          for(let c=0;c<t.tbody.rows[r].cells.length;c++){
            row.push('"' + t.tbody.rows[r].cells[c].innerText.replace(/"/g, '""') + '"');
          }
          csv.push(row.join(","));
        }
        csv.push(""); // 段落分け
      });
      let blob = new Blob([csv.join("\n")], { type: "text/csv" });
      let link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "table.csv";
      link.click();
    }

    // CSV読み込み（1つ目の表に反映）
    function uploadCSV(event) {
      let file = event.target.files[0];
      if (!file) return;
      let reader = new FileReader();
      reader.onload = function(e) {
        let rows = e.target.result.split("\n").map(r => r.split(","));
        let t = tables[0];
        t.header.innerHTML="";
        let headerRow = rows[0];
        headerRow.forEach(h=>{
          let th=document.createElement("th");
          th.textContent=h.replace(/^"|"$/g, '').replace(/""/g, '"');
          t.header.appendChild(th);
        });
        t.tbody.innerHTML="";
        for(let r=1;r<rows.length;r++){
          if(rows[r].length===1 && rows[r][0]==="") continue;
          let row=t.tbody.insertRow();
          rows[r].forEach(val=>{
            let cell=row.insertCell();
            cell.contentEditable="true";
            cell.innerText=val.replace(/^"|"$/g, '').replace(/""/g, '"');
          });
        }
      };
      reader.readAsText(file);
    }

    // リセット
    function resetTable() {
      tables.forEach(t=>{
        t.header.innerHTML="";
        t.tbody.innerHTML="<tr></tr>";
      });
      localStorage.clear();
    }
  </script>
</body>
</html>