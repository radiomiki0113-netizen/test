<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>就職活動メモ 完全版</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
h1 { font-size: 24px; }
h3 { font-size: 18px; margin-top: 20px; font-weight: normal; }
table { border-collapse: collapse; margin-bottom: 20px; width: 100%; table-layout: fixed; }
th, td { border: 1px solid #000; padding: 8px; text-align: left; overflow: hidden; white-space: nowrap; }
th { cursor: ew-resize; }
button { margin: 3px; }
</style>
</head>
<body>

<h1 contenteditable="true">就職活動 メモ</h1>

<br>

<h3 contenteditable="true">動いている企業</h3>
<table id="table1">
  <thead>
    <tr>
      <th contenteditable="true">企業名</th>
      <th contenteditable="true">業種</th>
      <th contenteditable="true">選考状況</th>
      <th contenteditable="true">次回予定</th>
    </tr>
  </thead>
  <tbody>
    <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
  </tbody>
</table>

<br>

<h3 contenteditable="true">2段目の表用サブタイトル</h3>
<table id="table2">
  <thead>
    <tr>
      <th contenteditable="true">項目1</th>
      <th contenteditable="true">項目2</th>
      <th contenteditable="true">項目3</th>
      <th contenteditable="true">項目4</th>
    </tr>
  </thead>
  <tbody>
    <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
  </tbody>
</table>

<div>
  <button onclick="addRow('table1')">行追加</button>
  <button onclick="removeRow('table1')">行削除</button>
  <button onclick="addCol('table1')">列追加</button>
  <button onclick="removeCol('table1')">列削除</button>

  <button onclick="addRow('table2')">行追加</button>
  <button onclick="removeRow('table2')">行削除</button>
  <button onclick="addCol('table2')">列追加</button>
  <button onclick="removeCol('table2')">列削除</button>

  <button onclick="resetTables()">リセット</button>
  <button onclick="saveTables()">保存</button>
  <button onclick="exportCSV()">CSVとして保存</button>
  <button onclick="document.getElementById('csvFileInput').click()">CSVインポート</button>
  <input type="file" id="csvFileInput" accept=".csv" style="display:none" onchange="importCSV(event)">
</div>

<script>
/* --- 行・列操作 --- */
function addRow(tableId){
  const tbody=document.getElementById(tableId).tBodies[0];
  const cols=tbody.rows[0]?tbody.rows[0].cells.length:1;
  const row=tbody.insertRow();
  for(let i=0;i<cols;i++){ const cell=row.insertCell(); cell.contentEditable="true"; }
}
function removeRow(tableId){
  const tbody=document.getElementById(tableId).tBodies[0];
  if(tbody.rows.length>1) tbody.deleteRow(-1);
}
function addCol(tableId){
  const tbody=document.getElementById(tableId).tBodies[0];
  const ths=document.getElementById(tableId).tHead.rows[0];
  const th=document.createElement('th'); th.innerText=`列${ths.cells.length+1}`; th.style.width='100px'; th.contentEditable="true"; ths.appendChild(th);
  for(let row of tbody.rows){ const cell=row.insertCell(); cell.contentEditable="true"; }
  makeWidthEditable(document.getElementById(tableId));
}
function removeCol(tableId){
  const tbody=document.getElementById(tableId).tBodies[0];
  const ths=document.getElementById(tableId).tHead.rows[0];
  if(ths.cells.length>1){ ths.deleteCell(-1); for(let row of tbody.rows) row.deleteCell(-1); }
}

/* --- リセット --- */
function resetTables(){
  ['table1','table2'].forEach(id=>{
    const table=document.getElementById(id);
    table.tBodies[0].innerHTML='';
    const cols=table.tHead.rows[0].cells.length;
    const row=table.tBodies[0].insertRow();
    for(let i=0;i<cols;i++){ const cell=row.insertCell(); cell.contentEditable="true"; }
  });
  localStorage.removeItem('tableData'); 
  localStorage.removeItem('tableWidths'); 
}

/* --- 保存・復元 --- */
function saveTables(){
  const data={};
  const elements=[document.querySelector('h1'), ...document.querySelectorAll('h3')];
  data['texts']=elements.map(el=>el.innerText);
  document.querySelectorAll('table').forEach((table,index)=>{
    const rows=[];
    for(let row of table.rows){
      const cells=[];
      for(let cell of row.cells) cells.push(cell.innerText);
      rows.push(cells);
    }
    data['table'+(index+1)]=rows;
  });
  localStorage.setItem('tableData',JSON.stringify(data));

  const widths={};
  ['table1','table2'].forEach(id=>{
    const ths=document.getElementById(id).tHead.rows[0].cells;
    widths[id]=Array.from(ths).map(th=>th.offsetWidth);
  });
  localStorage.setItem('tableWidths',JSON.stringify(widths));
  alert("保存しました！");
}

window.onload=()=>{
  const saved=localStorage.getItem('tableData');
  if(saved){
    const data=JSON.parse(saved);
    const texts=[document.querySelector('h1'), ...document.querySelectorAll('h3')];
    data.texts.forEach((txt,i)=>{ if(texts[i]) texts[i].innerText=txt; });
    for(let key in data){
      if(key.startsWith('table')){
        const table=document.getElementById(key);
        const tbody=table.tBodies[0]; tbody.innerHTML='';
        const thead=table.tHead; thead.innerHTML='';
        data[key].forEach((rowData,rowIndex)=>{
          if(rowIndex===0){
            const row=thead.insertRow();
            rowData.forEach(cellData=>{ const th=document.createElement('th'); th.contentEditable="true"; th.innerText=cellData; row.appendChild(th); });
          } else {
            const row=tbody.insertRow();
            rowData.forEach(cellData=>{ const cell=row.insertCell(); cell.contentEditable="true"; cell.innerText=cellData; });
          }
        });
      }
    }
  }

  const widthsSaved=localStorage.getItem('tableWidths');
  if(widthsSaved){
    const widths=JSON.parse(widthsSaved);
    ['table1','table2'].forEach(id=>{
      const ths=document.getElementById(id).tHead.rows[0].cells;
      widths[id].forEach((w,i)=>{ if(ths[i]) ths[i].style.width=w+'px'; });
    });
  }

  makeWidthEditable(document.getElementById('table1'));
  makeWidthEditable(document.getElementById('table2'));
};

/* --- CSV --- */
function exportCSV(){
  let csv='';
  csv+='"'+document.querySelector('h1').innerText.replace(/"/g,'""')+'"\n\n';
  const h3s=document.querySelectorAll('h3');
  h3s.forEach((h,index)=>{
    csv+='"'+h.innerText.replace(/"/g,'""')+'"\n';
    const table=document.getElementById('table'+(index+1));
    for(let row of table.rows){
      const cells=[];
      for(let cell of row.cells) cells.push(cell.innerText.replace(/"/g,'""'));
      csv+='"'+cells.join('","')+'"\n';
    }
    csv+='\n';
  });
  const blob=new Blob([csv],{type:'text/csv'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='tables.csv'; a.click();
}

function importCSV(event){
  const file=event.target.files[0];
  if(!file) return;
  const reader=new FileReader();
  reader.onload=e=>{
    const lines=e.target.result.split('\n');
    let stage=0; // 0=h1,1=h3+table1,2=h3+table2
    let currentTable=null;
    lines.forEach(line=>{
      line=line.trim();
      if(line==='') return;
      line=line.replace(/^"|"$/g,'').replace(/""/g,'"');
      if(stage===0){
        document.querySelector('h1').innerText=line;
        stage=1;
      } else if(stage===1){
        document.querySelectorAll('h3')[0].innerText=line;
        currentTable=document.getElementById('table1'); currentTable.tBodies[0].innerHTML=''; currentTable.tHead.innerHTML='';
      } else if(stage===2){
        document.querySelectorAll('h3')[1].innerText=line;
        currentTable=document.getElementById('table2'); currentTable.tBodies[0].innerHTML=''; currentTable.tHead.innerHTML='';
      } else {
        // 行データ
        const cells=line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(c=>c.replace(/^"|"$/g,'').replace(/""/g,'"'));
        if(currentTable.tHead.rows.length===0){
          const row=currentTable.tHead.insertRow();
          cells.forEach(c=>{ const th=document.createElement('th'); th.contentEditable="true"; th.innerText=c; row.appendChild(th); });
        } else {
          const row=currentTable.tBodies[0].insertRow();
          cells.forEach(c=>{ const td=row.insertCell(); td.contentEditable="true"; td.innerText=c; });
        }
      }
      if(stage<2) stage++;
    });
  };
  reader.readAsText(file);
}

/* --- iPhone列幅長押し --- */
function makeWidthEditable(table){
  const cols=table.querySelectorAll('th');
  cols.forEach(th=>{
    let startX=0, startWidth=0;
    th.addEventListener('touchstart',e=>{ startX=e.touches[0].clientX; startWidth=th.offsetWidth; });
    th.addEventListener('touchmove',e=>{ const dx=e.touches[0].clientX-startX; th.style.width=(startWidth+dx)+'px'; });
  });
}
</script>
</body>
</html>