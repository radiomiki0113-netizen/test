<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>å°±è·æ´»å‹• ãƒ¡ãƒ¢</title>
<style>
/* ğŸ¨ ãƒ‡ã‚¶ã‚¤ãƒ³CSS (å‰å›ã®æ”¹è‰¯ç‰ˆã‹ã‚‰å¤‰æ›´ãªã—) */
:root {
  --primary-color: #007bff;
  --secondary-color: #6c757d;
  --light-bg: #f8f9fa;
  --border-color: #dee2e6;
  --header-bg: #e9ecef;
}
body { 
  font-family: 'Helvetica Neue', Arial, sans-serif; 
  padding: 30px; 
  background-color: var(--light-bg);
  color: #333;
  max-width: 1200px;
  margin: 0 auto;
}
h1 { 
  font-size: 28px; 
  border-bottom: 3px solid var(--primary-color);
  padding-bottom: 10px;
  margin-bottom: 30px;
  color: #212529;
  cursor: text;
}
h3 { 
  font-size: 20px; 
  margin-top: 30px; 
  margin-bottom: 15px; 
  font-weight: 600;
  color: var(--primary-color);
  cursor: text;
}
table { 
  border-collapse: collapse; 
  margin-bottom: 25px; 
  width: 100%; 
  table-layout: fixed; 
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
  background-color: white;
}
th, td { 
  border: 1px solid var(--border-color); 
  padding: 12px 15px; 
  text-align: left; 
  white-space: normal;
  word-wrap: break-word;
  vertical-align: top;
}
th {
  background-color: var(--header-bg); 
  font-weight: bold;
  color: #495057;
  position: sticky; 
  top: 0;
  z-index: 10;
}
td[contenteditable="true"]:focus {
  background-color: #fffacd; 
  outline: 1px solid var(--primary-color);
}

.button-group {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
  flex-wrap: wrap;
}
.table-controls {
    border: 1px solid var(--border-color);
    padding: 10px;
    border-radius: 5px;
    background-color: white;
}
.global-controls {
    margin-top: 20px;
    padding: 10px 0;
}
button {
  background-color: var(--primary-color);
  color: white;
  border: none;
  padding: 10px 15px;
  border-radius: 5px;
  cursor: pointer;
  transition: background-color 0.2s, transform 0.1s;
  font-weight: 500;
}
button:hover {
  background-color: #0056b3;
}
button:active {
  transform: scale(0.98);
}
.secondary-btn {
  background-color: var(--secondary-color);
}
.secondary-btn:hover {
  background-color: #5a6268;
}
</style>
</head>
<body>

<h1 contenteditable="true">å°±è·æ´»å‹• ãƒ¡ãƒ¢</h1>
<br>

<h3 contenteditable="true">å‹•ã„ã¦ã„ã‚‹ä¼æ¥­</h3>
<table id="table1">
  <thead>
    <tr>
      <th contenteditable="true">ä¼æ¥­å</th>
      <th contenteditable="true">æ¥­ç¨®</th>
      <th contenteditable="true">é¸è€ƒçŠ¶æ³</th>
      <th contenteditable="true">æ¬¡å›äºˆå®š</th>
    </tr>
  </thead>
  <tbody>
    <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
  </tbody>
</table>

<div class="button-group table-controls">
  <button onclick="addRow('table1')">è¡Œè¿½åŠ </button>
  <button onclick="removeRow('table1')" class="secondary-btn">è¡Œå‰Šé™¤</button>
  <button onclick="addCol('table1')">åˆ—è¿½åŠ </button>
  <button onclick="removeCol('table1')" class="secondary-btn">åˆ—å‰Šé™¤</button>
</div>

<h3 contenteditable="true">æƒ…å ±åé›†ä¸­ã®ä¼æ¥­</h3>
<table id="table2">
  <thead>
    <tr>
      <th contenteditable="true">ä¼æ¥­å</th>
      <th contenteditable="true">èˆˆå‘³åº¦</th>
      <th contenteditable="true">å‚™è€ƒ</th>
      <th contenteditable="true">æƒ…å ±æº</th>
    </tr>
  </thead>
  <tbody>
    <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
  </tbody>
</table>

<div class="button-group table-controls">
  <button onclick="addRow('table2')">è¡Œè¿½åŠ </button>
  <button onclick="removeRow('table2')" class="secondary-btn">è¡Œå‰Šé™¤</button>
  <button onclick="addCol('table2')">åˆ—è¿½åŠ </button>
  <button onclick="removeCol('table2')" class="secondary-btn">åˆ—å‰Šé™¤</button>
</div>

<div class="button-group global-controls">
  <button onclick="saveTables()">ãƒ‡ãƒ¼ã‚¿ä¿å­˜ (ãƒ–ãƒ©ã‚¦ã‚¶)</button>
  <button onclick="exportCSV()" class="secondary-btn">CSVã¨ã—ã¦ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
  <button onclick="document.getElementById('csvFileInput').click()" class="secondary-btn">CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
  <button onclick="resetTables()">å…¨ãƒªã‚»ãƒƒãƒˆ</button>
  <input type="file" id="csvFileInput" accept=".csv" style="display:none" onchange="importCSV(event)">
</div>

<script>
// --- JSé–¢æ•°ã®çµ±åˆã¨ã‚¨ãƒ©ãƒ¼è€æ€§ã®å¼·åŒ– ---

// è£œåŠ©é–¢æ•°
function getTableHeadCells(tableId) {
    const table = document.getElementById(tableId);
    // ãƒ˜ãƒƒãƒ€ãƒ¼è¡ŒãŒç¢ºå®Ÿã«å­˜åœ¨ã™ã‚‹ã‚ˆã†ã«ãƒã‚§ãƒƒã‚¯
    if (table && table.tHead && table.tHead.rows.length > 0) {
        return table.tHead.rows[0].cells;
    }
    return [];
}
function getTableBody(tableId) {
    return document.getElementById(tableId).tBodies[0];
}

// ------------------------------------
// 1. ãƒ†ãƒ¼ãƒ–ãƒ«æ“ä½œé–¢æ•°
// ------------------------------------
function addRow(tableId){
  const tbody = getTableBody(tableId);
  const headCells = getTableHeadCells(tableId);
  const cols = headCells.length;
  
  if (cols === 0) {
      alert("å…ˆã«åˆ—ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ï¼‰ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚");
      return; 
  }

  const row = tbody.insertRow();
  for(let i=0; i<cols; i++){ 
    const cell=row.insertCell(); 
    cell.contentEditable="true"; 
  }
}

function removeRow(tableId){
  const tbody = getTableBody(tableId);
  if(tbody.rows.length > 1) {
    tbody.deleteRow(-1);
  } else if (tbody.rows.length === 1) {
    // 1è¡Œã®å ´åˆã¯å†…å®¹ã‚¯ãƒªã‚¢
    Array.from(tbody.rows[0].cells).forEach(cell => cell.innerText = '');
  }
}

function addCol(tableId){
  const table = document.getElementById(tableId);
  const tbody = getTableBody(tableId);
  
  // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’å–å¾—ã¾ãŸã¯ä½œæˆ
  let tHeadRow;
  if (table.tHead && table.tHead.rows.length > 0) {
      tHeadRow = table.tHead.rows[0];
  } else {
      if (!table.tHead) table.createTHead();
      tHeadRow = table.tHead.insertRow();
  }
  
  // ãƒ˜ãƒƒãƒ€ãƒ¼ã«æ–°ã—ã„åˆ—ã‚’è¿½åŠ 
  const th = document.createElement('th'); 
  th.innerText = `æ–°è¦åˆ—`;
  th.contentEditable="true"; 
  tHeadRow.appendChild(th);
  
  // ãƒ‡ãƒ¼ã‚¿è¡Œã«æ–°ã—ã„ã‚»ãƒ«ã‚’è¿½åŠ 
  for(let row of tbody.rows){ 
    const cell=row.insertCell(); 
    cell.contentEditable="true"; 
  }
  
  // ãƒ‡ãƒ¼ã‚¿è¡ŒãŒã‚¼ãƒ­ã®å ´åˆã€ãƒ˜ãƒƒãƒ€ãƒ¼ã«åˆã‚ã›ã¦ç©ºã®è¡Œã‚’ä½œæˆ
  if (tbody.rows.length === 0) {
      const row = tbody.insertRow();
      const cell = row.
