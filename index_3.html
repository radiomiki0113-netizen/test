<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å°±è·æ´»å‹•ãƒ¡ãƒ¢</title>
<style>
/* ğŸ¨ ãƒ‡ã‚¶ã‚¤ãƒ³CSS - æœ€çµ‚å®Œå…¨å®‰å®šç‰ˆ (æ ç·šã€ä¸­å¤®æƒãˆã€å¹…ã®å›ºå®šã‚’å¼·åˆ¶é©ç”¨) */
:root {
  --primary-color: #007bff;
  --secondary-color: #6c757d;
  --light-bg: #f8f9fa;
  --border-color: #dee2e6;
  --header-bg: #e9ecef;
  
  --color-yellow: #fff3cd; 
  --color-green: #d4edda;
  --color-red: #f8d7da;
}
body { 
  font-family: 'Helvetica Neue', Arial, sans-serif; 
  padding: 30px; 
  background-color: var(--light-bg);
  color: #333;
  max-width: 1200px;
  margin: 0 auto;
}

h1 { 
  font-size: 28px; 
  border-bottom: 3px solid var(--primary-color);
  padding-bottom: 10px;
  margin-bottom: 30px;
  color: #212529;
  cursor: pointer; 
}
h2 {
  font-size: 20px; 
  margin-top: 30px; 
  margin-bottom: 15px; 
  font-weight: 600;
  color: var(--primary-color);
  cursor: pointer; 
}

table { 
  border-collapse: collapse; 
  margin-bottom: 25px; 
  width: 100%; 
  table-layout: fixed !important; /* â˜…â˜…â˜… TABLE LAYOUTã‚’å¼·åˆ¶é©ç”¨ â˜…â˜…â˜… */
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
  background-color: white;
  border: 1px solid var(--border-color); 
}

/* â˜…â˜…â˜… æ ç·šã¨ã‚»ãƒ«ã®å¼·åˆ¶é©ç”¨ â˜…â˜…â˜… */
th, td { 
  border: 1px solid var(--border-color) !important; /* æ ç·šã‚’å¼·åˆ¶é©ç”¨ */
  padding: 12px 15px; 
  white-space: normal;
  word-wrap: break-word;
  vertical-align: middle; 
  box-sizing: border-box; 
  text-align: center; 
}

th { 
  background-color: var(--header-bg); 
  font-weight: bold; 
  color: #495057; 
  position: sticky; 
  top: 0;
  z-index: 10;
  height: 60px; 
}

/* ğŸš© TDå…±é€šã‚¹ã‚¿ã‚¤ãƒ« (flexã§ãƒ©ãƒƒãƒ‘ãƒ¼ã‚’ä¸­å¤®é…ç½®) */
td {
  padding: 0; 
  height: 60px; 
  position: relative; 
  display: flex; /* flexã§å†…éƒ¨è¦ç´ ã‚’åˆ¶å¾¡ */
  justify-content: center; /* æ°´å¹³æ–¹å‘ã®ä¸­å¤®æƒãˆ */
  align-items: center; /* å‚ç›´æ–¹å‘ã®ä¸­å¤®æƒãˆ */
  cursor: pointer; 
  transition: background-color 0.2s, box-shadow 0.1s;
}

td.selected-cell {
    box-shadow: 0 0 0 3px var(--primary-color) inset;
    border-color: var(--primary-color) !important;
}

/* ğŸš© ã‚»ãƒ«å†…ã®ã‚³ãƒ³ãƒ†ãƒŠ (å†…å®¹ã‚’ä¸­å¤®ã«é…ç½®ã™ã‚‹ãƒ©ãƒƒãƒ‘ãƒ¼) */
.cell-content-wrapper {
  box-sizing: border-box;
  width: 100%;
  height: 100%; 
  padding: 12px 15px; 
  
  /* ä¸­å¤®æƒãˆã‚’ç¶™æ‰¿ã—ã€pre-wrapã§æ”¹è¡Œã‚’ä¿æŒ */
  white-space: pre-wrap; 
  text-align: center; 
}

/* ğŸš© ç·¨é›†ç”¨Inputè¦ç´ ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.cell-input {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
  box-sizing: border-box;
  border: none;
  background-color: #fffacd; 
  padding: 12px 15px;
  font-family: inherit;
  font-size: inherit;
  text-align: center; 
  outline: 1px solid var(--primary-color);
  z-index: 20; 
}

/* ãƒœã‚¿ãƒ³ãªã©ã®ã‚¹ã‚¿ã‚¤ãƒ« (å¤‰æ›´ãªã—) */
.button-group {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
  flex-wrap: wrap;
}
.table-controls {
    border: 1px solid var(--border-color);
    padding: 10px;
    border-radius: 5px;
    background-color: white;
}
.global-controls {
    margin-top: 20px;
    padding: 10px 0;
}
button {
  background-color: var(--primary-color);
  color: white;
  border: none;
  padding: 10px 15px;
  border-radius: 5px;
  cursor: pointer;
  transition: background-color 0.2s, transform 0.1s;
  font-weight: 500;
}
button:hover {
  background-color: #0056b3;
}
button:active {
  transform: scale(0.98);
}
.secondary-btn {
  background-color: var(--secondary-color);
}
.secondary-btn:hover {
  background-color: #5a6268;
}

.color-btn {
    padding: 8px 10px; 
    border-radius: 5px; 
    margin-right: 5px;
    border: 2px solid var(--border-color);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    transition: transform 0.1s, box-shadow 0.1s;
}
.color-btn:hover {
    transform: scale(1.05); 
    box-shadow: 0 0 0 2px var(--primary-color);
}
.color-btn-yellow { background-color: var(--color-yellow); color: #856404; font-weight: bold;}
.color-btn-green { background-color: var(--color-green); color: #155724; font-weight: bold;}
.color-btn-red { background-color: var(--color-red); color: #721c24; font-weight: bold;}
</style>
</head>
<body>

    <h1 ondblclick="makeEditableTitle(this)">å°±è·æ´»å‹•ãƒ¡ãƒ¢</h1>

    <div class="table-container">
        <h2 ondblclick="makeEditableTitle(this)">å‹•ã„ã¦ã„ã‚‹ä¼æ¥­</h2> 
        <table id="active-companies-table">
            <thead>
                <tr>
                    <th contenteditable="true">ä¼æ¥­å</th>
                    <th contenteditable="true">æ¥­ç¨®</th>
                    <th contenteditable="true">é¸è€ƒçŠ¶æ³</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td onclick="selectCell(this)" ondblclick="makeEditable(this)"></td>
                    <td onclick="selectCell(this)" ondblclick="makeEditable(this)"></td>
                    <td onclick="selectCell(this)" ondblclick="makeEditable(this)"></td>
                </tr>
            </tbody>
        </table>
        <div class="button-group table-controls">
            <button onclick="addRow('active-companies-table')">è¡Œè¿½åŠ </button>
            <button onclick="deleteRow('active-companies-table')" class="secondary-btn">è¡Œå‰Šé™¤</button>
            <button onclick="addColumn('active-companies-table')">åˆ—è¿½åŠ </button>
            <button onclick="deleteColumn('active-companies-table')">åˆ—å‰Šé™¤</button>
        </div>
    </div>

    <hr>

    <div class="table-container">
        <h2 ondblclick="makeEditableTitle(this)">æƒ…å ±åé›†ä¸­ä¼æ¥­</h2>
        <table id="research-companies-table">
            <thead>
                <tr>
                    <th contenteditable="true">ä¼æ¥­å</th>
                    <th contenteditable="true">èˆˆå‘³åº¦</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td onclick="selectCell(this)" ondblclick="makeEditable(this)"></td>
                    <td onclick="selectCell(this)" ondblclick="makeEditable(this)"></td>
                </tr>
            </tbody>
        </table>
        <div class="button-group table-controls">
            <button onclick="addRow('research-companies-table')">è¡Œè¿½åŠ </button>
            <button onclick="deleteRow('research-companies-table')" class="secondary-btn">è¡Œå‰Šé™¤</button>
            <button onclick="addColumn('research-companies-table')">åˆ—è¿½åŠ </button>
            <button onclick="deleteColumn('research-companies-table')">åˆ—å‰Šé™¤</button>
        </div>
    </div>

    <hr>

    <div class="button-group global-controls">
        <button class="color-btn color-btn-yellow" onclick="applyColor('var(--color-yellow)')" title="ã‚¤ã‚¨ãƒ­ãƒ¼">é»„è‰²</button>
        <button class="color-btn color-btn-green" onclick="applyColor('var(--color-green)')" title="ã‚°ãƒªãƒ¼ãƒ³">ç·‘è‰²</button>
        <button class="color-btn color-btn-red" onclick="applyColor('var(--color-red)')" title="ãƒ¬ãƒƒãƒ‰">èµ¤è‰²</button>
        <button onclick="applyColor('')" class="secondary-btn">è‰²ã‚’ã‚¯ãƒªã‚¢</button>
        
        <hr style="width: 100%; border: none; border-bottom: 1px dashed #ccc; margin: 10px 0;">

        <button onclick="saveData()">ãƒ‡ãƒ¼ã‚¿ä¿å­˜ (ãƒ–ãƒ©ã‚¦ã‚¶)</button>
        <button onclick="exportCSV()" class="secondary-btn">CSVã¨ã—ã¦ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
        <input type="file" id="csv-file-input" accept=".csv" style="display:none;" onchange="importCSV(event)">
        <button onclick="document.getElementById('csv-file-input').click()" class="secondary-btn">CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
        <button onclick="resetAll()">å…¨ãƒªã‚»ãƒƒãƒˆ</button>
    </div>

<script>
let selectedCell = null;

function getTableHeadCells(tableId) {
    const table = document.getElementById(tableId);
    if (table && table.tHead && table.tHead.rows.length > 0) {
        return table.tHead.rows[0].cells;
    }
    return [];
}

function wrapContent(cell, text = '') {
    if (cell.tagName === 'TH') {
        cell.innerText = text;
        return;
    }
    
    let wrapper = cell.querySelector('.cell-content-wrapper');
    
    if (!wrapper) { 
        wrapper = document.createElement('div');
        wrapper.className = 'cell-content-wrapper';
        
        const existingText = cell.textContent.trim();
        cell.textContent = ''; 
        
        cell.appendChild(wrapper);
        wrapper.innerText = text || existingText; 
    } else {
        wrapper.innerText = text;
    }
}

function getCellText(cell) {
    if (cell.tagName === 'TH') {
        return cell.innerText;
    }
    const wrapper = cell.querySelector('.cell-content-wrapper');
    return wrapper ? wrapper.innerText : '';
}

function setCellText(cell, text) {
    if (cell.tagName === 'TH') {
        cell.innerText = text;
        return;
    }
    
    const wrapper = cell.querySelector('.cell-content-wrapper');
    if (wrapper) {
        wrapper.innerText = text;
    } else {
        wrapContent(cell, text);
    }
}

function selectCell(cell) {
    if (cell.tagName === 'TH' || cell.querySelector('input.cell-input')) return; 

    if (selectedCell) {
        selectedCell.classList.remove('selected-cell');
    }
    
    if (selectedCell !== cell) {
        cell.classList.add('selected-cell');
        selectedCell = cell;
    } else {
        selectedCell = null;
    }
}

function applyColor(colorVariable) {
    if (!selectedCell) {
        alert("è‰²ã‚’å¤‰æ›´ã—ãŸã„ã‚»ãƒ«ã‚’ä¸€åº¦ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠã—ã¦ãã ã•ã„ã€‚");
        return;
    }
    
    if (selectedCell.tagName === 'TH') {
        alert("é …ç›®åï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ï¼‰ã®ã‚»ãƒ«
